(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[788],{661718:function(e,n,r){"use strict";r.d(n,{nu:function(){return S},LR:function(){return C},MP:function(){return I},$U:function(){return A}});var t=r(896156),o=r(387329),i=r(887757),a=r.n(i),c=r(692137),u=r(785893),l=r(522318),s=r(541749),f=r(282),d=r(464436),p=r(443700),b=r(793889),h=r(485639),y=r(608286),m=r(496486),g=r(672679),v=r(388767),j=r(492481),x=r(126464),O=r(967964),w=r(729168);function Z(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function _(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?Z(Object(r),!0).forEach((function(n){(0,t.Z)(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Z(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function k(e,n){var r;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,n){if(!e)return;if("string"===typeof e)return P(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return P(e,n)}(e))||n&&e&&"number"===typeof e.length){r&&(e=r);var t=0,o=function(){};return{s:o,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return a=e.done,e},e:function(e){c=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw i}}}}function P(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}var S=[{selector:"rank",name:"Rank",maxWidth:"60px",minWidth:"30px",center:!0,sortable:!0},{selector:"icon",name:"Avatar",width:"60px",center:!0,hide:"sm",cell:function(e){return e.icon>0?(0,u.jsx)(g.LazyLoadImage,{src:r(664391)("./".concat(e.icon,".png")),width:"80",effect:"opacity"}):(0,u.jsx)("div",{})}},{name:"User Name",maxWidth:"150px",minWidth:"50px",grow:1,cell:function(e){var n=(0,x.Z)();return(0,u.jsx)(l.Z,{style:{cursor:"pointer"},onClick:function(){return n.push("/user?id=".concat(e.user))},children:e.name})}},{name:"Score",selector:"score",width:"130px",hide:"md"},{name:"Formation",center:!0,width:"400px",cell:function(e){var n;return e?(0,u.jsx)(s.Z,{container:!0,direction:"row",wrap:"nowrap",children:null===(n=e.party)||void 0===n?void 0:n.map((function(e){return(0,u.jsx)(s.Z,{container:!0,direction:"column",item:!0,children:e.main>0&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(s.Z,{item:!0,style:{position:"relative"},children:(0,u.jsx)(w.Z,{member_id:e.main,width:"80",lv:e.main_lv,ex:1===e.main_ex_flg})}),(0,u.jsxs)(s.Z,{container:!0,direction:"column",children:[(0,u.jsxs)(s.Z,{container:!0,direction:"row",children:[(0,u.jsx)(s.Z,{item:!0,children:0!==e.sub1&&(0,u.jsx)("div",{children:(0,u.jsx)(g.LazyLoadImage,{src:r(82779)("./".concat(e.sub1,".png")),width:"40",effect:"opacity"})})}),(0,u.jsx)(s.Z,{item:!0,children:0!==e.sub2&&(0,u.jsx)(g.LazyLoadImage,{src:r(82779)("./".concat(e.sub2,".png")),width:"40",effect:"opacity"})})]}),(0,u.jsxs)(s.Z,{container:!0,direction:"row",children:[(0,u.jsx)(s.Z,{item:!0,children:0!==e.weapon&&(0,u.jsx)(g.LazyLoadImage,{src:r(381903)("./".concat(e.weapon.toString().slice(0,-1),".png")),width:"40",effect:"opacity"})}),(0,u.jsx)(s.Z,{item:!0,children:0!==e.acc&&(0,u.jsx)(g.LazyLoadImage,{src:r(429513)("./".concat(e.acc.toString().slice(0,-1),".png")),width:"40",effect:"opacity"})})]}),(0,u.jsx)(s.Z,{container:!0,direction:"row",justify:"center",children:(0,u.jsx)(s.Z,{item:!0,style:{position:"relative",height:"40px"},children:0!==e.specialskill&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(g.LazyLoadImage,{src:r(767207)("./".concat(e.specialskill.toString().slice(0,-1)+"1",".png")),height:"40",style:{position:"relative",left:"20px",zIndex:0},effect:"opacity"}),(0,u.jsx)(g.LazyLoadImage,{src:r(245112)("./".concat("1"===e.specialskill.toString().slice(-1)?"icon_skill_01":"icon_skill_02",".png")),height:"40",style:{position:"relative",zIndex:1,left:"-20px"},effect:"opacity"})]})})})]})]})},e.form_no)}))}):(0,u.jsx)("div",{})}}],C=function(e){var n=e.filterText,r=e.onFilter,t=e.option,o=e.onSetOption,i=(0,x.Z)(),l=i.query,s=j.Z.useContainer().open,m=O.W.useContainer(),g=(m.callFunction,m.isAuthenticated),w=m.mongodb,Z=(0,v.useQuery)(["arena_ids",g],(0,c.Z)(a().mark((function e(){var n,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!g){e.next=6;break}return e.next=3,w.db("konofan").collection("arenas").find({});case 3:return n=e.sent,"string"!==typeof l.arena_id&&(r=n.slice(-1)[0],i.shallowPush({arena_id:r._id,arena_date:r.dates.slice(-1)[0]})),e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})))).data;if(Z&&l.arena_id){var _=Z;return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(f.Z,{onClick:function(){return s()},variant:"outlined",color:"secondary",style:{marginRight:20,alignSelf:"flex-end"},children:"Filter By Member"}),(0,u.jsxs)(d.Z,{children:[(0,u.jsx)(p.Z,{htmlFor:"arena-id",children:"Arena ID"}),(0,u.jsx)(b.Z,{onChange:function(e){return i.shallowPush({arena_id:e.target.value,arena_date:_.find((function(n){return n._id===e.target.value})).dates.slice(-1)[0]})},name:"arena_id",value:l.arena_id,style:{width:"100px",backgroundColor:"#ffffff70"},children:_.map((function(e){var n=e._id;return(0,u.jsx)(h.Z,{value:n,style:{backgroundColor:"#ffffff70"},children:n},n)}))})]}),(0,u.jsxs)(d.Z,{children:[(0,u.jsx)(p.Z,{htmlFor:"date",children:"Date"}),(0,u.jsx)(b.Z,{onChange:function(e){return i.shallowPush({arena_date:e.target.value})},name:"date",labelId:"date",value:l.arena_date,style:{width:"150px",backgroundColor:"#ffffff70"},children:_.find((function(e){return e._id===l.arena_id})).dates.map((function(e){return(0,u.jsx)(h.Z,{value:e,style:{backgroundColor:"#ffffff70"},children:e},e)}))})]}),(0,u.jsx)(d.Z,{children:(0,u.jsx)(y.Z,{id:"search",type:"text",label:"Filter by name or user No",placeholder:"User name or No","aria-label":"Search Input",value:n,onChange:r})}),(0,u.jsxs)(d.Z,{children:[(0,u.jsx)(p.Z,{htmlFor:"group",children:"Group by"}),(0,u.jsxs)(b.Z,{onChange:o,name:"group",labelId:"group",value:t.group,style:{width:"150px",backgroundColor:"#ffffff70"},children:[(0,u.jsx)(h.Z,{style:{backgroundColor:"#ffffff70"},value:null,children:"None"}),(0,u.jsx)(h.Z,{style:{backgroundColor:"#ffffff70"},value:"FORMATION",children:"Formation"})]})]})]})}return(0,u.jsx)("div",{})},I=[{name:"Count",selector:"count",sortable:!0,center:!0,grow:1,maxWidth:"100px"},{name:"Formation",center:!0,width:"400px",cell:function(e){if(e)return(0,u.jsx)(s.Z,{container:!0,direction:"row",wrap:"nowrap",children:[].concat((0,o.Z)(e.front),[e.back1,e.back2]).map((function(e){return(0,u.jsx)(s.Z,{item:!0,style:{position:"relative"},children:(0,u.jsx)(w.Z,{member_id:e,width:"80",lv:"60"})})}))})}},{name:"Best Score",selector:"bestscore",center:!0}],A=function(e){var n,r=[],t=k(e);try{var o=function(){var e=n.value,t=e.party.map((function(e){return e.main})),o=t.slice(0,3).sort(),i=t[3],a=t[4],c=r.findIndex((function(e){return!!(0,m.isEqual)(e.front,o)&&(!(0!==i&&i!==e.back1||0!==a&&a!==e.back2)||void 0)}));if(-1===c)r.push({front:o,count:1,back1:i,back2:a,bestscore:e.bestscore});else{var u=r[c];r[c]=_(_({},u),{},{count:u.count+1,bestscore:u.bestscore<e.bestscore?e.bestcore:u.bestscore})}};for(t.s();!(n=t.n()).done;)o()}catch(i){t.e(i)}finally{t.f()}return(0,m.sortBy)(r,(function(e){return-e.count}))}},492481:function(e,n,r){"use strict";var t=r(387329),o=r(896156),i=r(667294);function a(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function c(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?a(Object(r),!0).forEach((function(n){(0,o.Z)(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}var u=(0,r(457186).f)((function(){var e=(0,i.useState)({included:[],excluded:[],isOpen:!1}),n=e[0],r=e[1];(0,i.useEffect)((function(){}),[n]);return{included:n.included,excluded:n.excluded,toggle:function(e,i){if("included"===i){if(n.excluded.includes(e))return}else if("excluded"===i&&n.included.includes(e))return;var a=n[i].findIndex((function(n){return n===e}));r(c(c({},n),{},-1===a?(0,o.Z)({},i,[].concat((0,t.Z)(n[i]),[e])):(0,o.Z)({},i,n[i].filter((function(e,n){return n!==a})))))},open:function(){r(c(c({},n),{},{isOpen:!0}))},close:function(){r(c(c({},n),{},{isOpen:!1}))},clear:function(){r(c(c({},n),{},{included:[],excluded:[]}))},isOpen:n.isOpen}}));n.Z=u},948950:function(e,n,r){"use strict";r.r(n),r.d(n,{__N_SSG:function(){return w},default:function(){return Z}});var t=r(785893),o=r(896156),i=r(418463),a=r(661718),c=r(667294),u=r(885515),l=r(492481),s=(r(504028),r(887757)),f=r.n(s),d=r(692137),p=r(388767),b=r(967964),h=r(126464);function y(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function m(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?y(Object(r),!0).forEach((function(n){(0,o.Z)(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}var g=function(e){e.lang;var n=b.W.useContainer(),r=n.mongodb,t=n.isAuthenticated,o=(0,h.Z)().query,i=o.arena_id,a=o.arena_date,c=(0,p.useQuery)([i,a,t],(0,d.Z)(f().mark((function e(){var n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i&&a&&t)){e.next=5;break}return e.next=3,r.db("konofan").collection("ranking").find({arena_id:i,createdAt:a},{sort:{rank:1}});case 3:return n=e.sent,e.abrupt("return",n);case 5:return e.abrupt("return",[]);case 6:case"end":return e.stop()}}),e)}))),{cacheTime:1e7}),u=c.data;c.isLoading;return{ranking_data:u?u.map((function(e){var n=e.party.map((function(n){return["main","sub1","sub2"].forEach((function(r){if(n[r]>0){var t=e.member.find((function(e){return e.member_id===n[r]}));n["".concat(r,"_lv")]=t.lv,n["".concat(r,"_ex_flg")]=t.ex_flg}})),n})),r=m(m({},e),{},{party:n});return delete r.member,r})):[]}};function v(e,n){var r;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,n){if(!e)return;if("string"===typeof e)return j(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return j(e,n)}(e))||n&&e&&"number"===typeof e.length){r&&(e=r);var t=0,o=function(){};return{s:o,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return a=e.done,e},e:function(e){c=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw i}}}}function j(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function x(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function O(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?x(Object(r),!0).forEach((function(n){(0,o.Z)(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}var w=!0,Z=function(e){var n=l.Z.useContainer(),r=n.included,s=n.excluded,f=(0,c.useState)({group:null}),d=f[0],p=f[1],b=(0,c.useState)(""),h=b[0],y=b[1],m=g({lang:"jp"}).ranking_data.filter((function(e){return e.name.toLowerCase().includes(h)||e.user.includes(h)}));m=_(m,r),m=k(m,s),"FORMATION"===d.group&&(m=(0,a.$U)(m));var v=(0,c.useMemo)((function(){return(0,t.jsx)(a.LR,{onFilter:function(e){return y(e.target.value)},filterText:h,option:d,onSetOption:function(e){var n=e.target.name,r=e.target.value;p(O(O({},d),{},(0,o.Z)({},n,r)))}})}),[h,d]);return(0,t.jsx)(i.Z,{style:{height:"100%",width:"100%"},children:(0,t.jsx)(u.Z,{title:"Top 1000 Ranking",columns:"FORMATION"===d.group?a.MP:a.nu,data:m,defaultSortAsc:!0,defaultSortField:"id",pagination:!0,subHeaderComponent:v,subHeader:!0})})},_=function(e,n){if(0===n.length)return e;var r,t=[],o=v(e);try{var i=function(){var e=r.value,o=e.party;if(!o)return{v:[]};var i=o.map((function(e){return e.main.toString()}));n.map((function(e){return i.includes(e)})).includes(!1)||t.push(e)};for(o.s();!(r=o.n()).done;){var a=i();if("object"===typeof a)return a.v}}catch(c){o.e(c)}finally{o.f()}return t},k=function(e,n){var r,t=[],o=v(e);try{var i=function(){var e=r.value,o=e.party;if(!o)return{v:[]};var i=o.map((function(e){return e.main.toString()}));n.map((function(e){return i.includes(e)})).includes(!0)||t.push(e)};for(o.s();!(r=o.n()).done;){var a=i();if("object"===typeof a)return a.v}}catch(c){o.e(c)}finally{o.f()}return t}},309650:function(e,n,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[lang]/ranking",function(){return r(948950)}])}},function(e){e.O(0,[774,272,662,431,433,108,185,786,720,726,767,616,434,941],(function(){return n=309650,e(e.s=n);var n}));var n=e.O();_N_E=n}]);